<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Uranus AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('planet-interaction', {/* same as others */
        init: function(){ const el=this.el; const scene=el.sceneEl; let lastX,lastY,isDragging=false; let currentRotation={x:0,y:0}; let currentScale=1; let startDist=null,startScale=null,startRot=null; const setup=()=>{ if(!scene||!scene.camera||!scene.canvas) return setTimeout(setup,100); const canvas=scene.canvas; function getPointer(e){return (e.touches&&e.touches.length)?e.touches[0]:e;} canvas.addEventListener('mousedown',(e)=>{isDragging=true;lastX=e.clientX;lastY=e.clientY;startRot={...currentRotation};}); window.addEventListener('mousemove',(e)=>{ if(!isDragging) return; let dx=e.clientX-lastX; let dy=e.clientY-lastY; currentRotation.y=startRot.y+dx*0.5; currentRotation.x=startRot.x-dy*0.5; el.setAttribute('rotation', `${currentRotation.x} ${currentRotation.y} 0`); }); window.addEventListener('mouseup',()=>{isDragging=false;}); canvas.addEventListener('wheel',(e)=>{ e.preventDefault(); currentScale += e.deltaY<0?0.1:-0.1; currentScale=Math.max(0.2,Math.min(3,currentScale)); el.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);}); canvas.addEventListener('touchstart',(e)=>{ if(e.touches.length===2){ startDist=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY); startScale=currentScale;} else {isDragging=true; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY; startRot={...currentRotation}; }},{passive:false}); canvas.addEventListener('touchmove',(e)=>{ if(e.touches.length===2 && startDist){ let newDist=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY); let scaleChange=newDist/startDist; currentScale=Math.max(0.2, Math.min(3, startScale*scaleChange)); el.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`); } else if(e.touches.length===1 && isDragging){ let dx=e.touches[0].clientX-lastX; let dy=e.touches[0].clientY-lastY; currentRotation.y=startRot.y+dx*0.5; currentRotation.x=startRot.x-dy*0.5; el.setAttribute('rotation', `${currentRotation.x} ${currentRotation.y} 0`); } },{passive:false}); canvas.addEventListener('touchend',(e)=>{ if(e.touches.length<2) startDist=null; if(e.touches.length===0) isDragging=false; }); const raycaster=new THREE.Raycaster(); const mouse=new THREE.Vector2(); function computeMouse(ev){ const rect=canvas.getBoundingClientRect(); mouse.x = ((ev.clientX-rect.left)/rect.width)*2-1; mouse.y = -((ev.clientY-rect.top)/rect.height)*2+1; } canvas.addEventListener('click',(e)=>{ computeMouse(e); raycaster.setFromCamera(mouse, scene.camera); const objs=raycaster.intersectObject(el.object3D, true); if(objs.length>0){ const label=el.parentEl.querySelector('#info'); if(label){ const vis=label.getAttribute('visible'); label.setAttribute('visible', !vis); } } }); }; setup(); }
      });
    </script>
  </head>
  <body style="margin:0; overflow:hidden;">
    <a-scene embedded arjs="sourceType: webcam;" renderer="logarithmicDepthBuffer: true;">
      <a-entity light="type: ambient; color: #888"></a-entity>
      <a-entity light="type: point; intensity: 1" position="0 2 2"></a-entity>

      <a-marker type="pattern" url="markers/uranus.patt">
        <a-entity>
          <a-sphere id="uranus" class="clickable" planet-interaction
            radius="0.45" material="src: url(texture/uranus.jpg)" animation="property: rotation; to: 0 360 0; loop: true; dur: 18000">
          </a-sphere>
          <a-entity id="info" visible="false" position="0 -0.9 0" text="value: Uranus: Tilted planet.; color: #fff; align: center"></a-entity>
        </a-entity>
      </a-marker>
    </a-scene>
  </body>
</html>